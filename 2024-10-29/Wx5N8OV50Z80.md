# å°å‚…å“¥é¡¹ç›®ï¼š OpenAi ä»£ç è¯„å®¡.
### ğŸ˜€ä»£ç è¯„åˆ†ï¼š80
#### ğŸ˜€ä»£ç é€»è¾‘ä¸ç›®çš„ï¼š
è¯¥ä»£ç ç‰‡æ®µä¸»è¦ç”¨äºå®ç°ä»£ç å®¡æŸ¥åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»£ç å®¡æŸ¥æ—¥å¿—çš„å†™å…¥ã€æ¶ˆæ¯é€šçŸ¥ç­‰ã€‚æ–°å¢äº†å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯å‘é€åŠŸèƒ½ï¼Œç”¨äºå°†å®¡æŸ¥æ—¥å¿—æ¨é€åˆ°å¾®ä¿¡ã€‚

#### ğŸ¤”é—®é¢˜ç‚¹ï¼š
1. **å®‰å…¨æ€§é—®é¢˜**ï¼šHTTPè¯·æ±‚ä¸­æœªä½¿ç”¨HTTPSï¼Œå­˜åœ¨æ•°æ®æ³„éœ²é£é™©ã€‚
2. **å¼‚å¸¸å¤„ç†**ï¼š`sendPostRequest`æ–¹æ³•ä¸­æœªå¯¹å¼‚å¸¸è¿›è¡Œè¯¦ç»†çš„å¤„ç†ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒã€‚
3. **ä»£ç é‡å¤**ï¼š`TemplateMessageDTO`ç±»ä¸­çš„`put`æ–¹æ³•é‡å¤ï¼Œåº”åˆå¹¶æˆ–åˆ é™¤ã€‚
4. **ä»£ç è´¨é‡**ï¼šä»£ç ä¸­æœ‰ä¸å¿…è¦çš„å¯¼å…¥ï¼Œä¾‹å¦‚`static com.sun.org.apache.xalan.internal.xsltc.compiler.Constants.CHARACTERS;`ã€‚
5. **æµ‹è¯•è¦†ç›–ç‡**ï¼šæ–°å¢åŠŸèƒ½æœªåœ¨æµ‹è¯•ç”¨ä¾‹ä¸­è¿›è¡Œå……åˆ†æµ‹è¯•ã€‚

#### ğŸ¯ä¿®æ”¹å»ºè®®ï¼š
1. ä½¿ç”¨HTTPSè¿›è¡Œé€šä¿¡ï¼Œæé«˜å®‰å…¨æ€§ã€‚
2. åœ¨`sendPostRequest`æ–¹æ³•ä¸­æ·»åŠ å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚
3. åˆå¹¶æˆ–åˆ é™¤`TemplateMessageDTO`ç±»ä¸­çš„é‡å¤`put`æ–¹æ³•ã€‚
4. åˆ é™¤ä¸å¿…è¦çš„å¯¼å…¥ï¼Œæé«˜ä»£ç è´¨é‡ã€‚
5. æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿æ–°å¢åŠŸèƒ½çš„æ­£ç¡®æ€§ã€‚

#### ğŸ’»ä¿®æ”¹åçš„ä»£ç ï¼š
```java
// OpenAiCodeReview.java
// ... å…¶ä»–ä»£ç  ...

private static void pushMessage(String logUrl){
    String accessToken = WXAccessTokenUtils.getAccessToken();
    System.out.println(accessToken);
    TemplateMessageDTO weixinTemplateMessageDTO = new TemplateMessageDTO();
    weixinTemplateMessageDTO.put("project","big-market");
    weixinTemplateMessageDTO.put("review",logUrl);
    weixinTemplateMessageDTO.setUrl(logUrl);
    String url = "https://api.weixin.qq.com/cgi-bin/message/template/send?access_token="+accessToken.replace("https://", "https://");
    sendPostRequest(url,JSON.toJSONString(weixinTemplateMessageDTO));
}

private static void sendPostRequest(String urlString, String jsonBody) {
    try {
        URL url = new URL(urlString);
        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
        conn.setRequestMethod("POST");
        conn.setRequestProperty("Content-Type", "application/json; utf-8");
        conn.setRequestProperty("Accept", "application/json");
        conn.setDoOutput(true);
        try (OutputStream os = conn.getOutputStream()) {
            byte[] input = jsonBody.getBytes(StandardCharsets.UTF_8);
            os.write(input, 0, input.length);
        }
        try (Scanner scanner = new Scanner(conn.getInputStream(), StandardCharsets.UTF_8.name())) {
            String response = scanner.useDelimiter("\\A").next();
            System.out.println(response);
        }
    } catch (Exception e) {
        e.printStackTrace();
    }
}

// TemplateMessageDTO.java
// ... å…¶ä»–ä»£ç  ...

public void put(String key, String value) {
    data.put(key, new HashMap<String, String>() {{
        put("value", value);
    }});
}

// WXAccessTokenUtils.java
// ... å…¶ä»–ä»£ç  ...

public static String getAccessToken() {
    return getAccessToken(APPID, SECRET);
}

public static String getAccessToken(String APPID, String SECRET) {
    try {
        String urlString = String.format(URL_TEMPLATE, GRANT_TYPE, APPID, SECRET);
        URL url = new URL(urlString);
        HttpURLConnection connection = (HttpURLConnection) url.openConnection();
        connection.setRequestMethod("GET");
        // ... å…¶ä»–ä»£ç  ...
    } catch (Exception e) {
        e.printStackTrace();
        return null;
    }
}

// ApiTest.java
// ... å…¶ä»–ä»£ç  ...

public void test_wx(){
    String accessToken = WXAccessTokenUtils.getAccessToken();
    System.out.println(accessToken);
    TemplateMessageDTO weixinTemplateMessageDTO = new TemplateMessageDTO();
    weixinTemplateMessageDTO.put("project","big-market");
    weixinTemplateMessageDTO.put("review","feat: æ–°åŠ åŠŸèƒ½");
    String url = "https://api.weixin.qq.com/cgi-bin/message/template/send?access_token="+accessToken.replace("https://", "https://");
    sendPostRequest(url,JSON.toJSONString(weixinTemplateMessageDTO));
}
```